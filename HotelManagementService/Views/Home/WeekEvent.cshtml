@using HotelManagementService.Enums
@using HotelManagementService.Models
@using HotelManagementService.ViewModels
@using Microsoft.Ajax.Utilities
@using WebGrease.Css.Extensions
@model IEnumerable<HotelManagementService.ViewModels.RoomEventsViewModel>
@helper ShowRoomState(Dictionary<Event, List<DateTime>> eventDate, DateTime dateAcctual)
{
    var dateList = new List<DateTime>();
    foreach (var d in eventDate.Values)
    {
        dateList.AddRange(d);
    }

    dateList = dateList.Where(x => x.Date >= dateAcctual && x.Date < dateAcctual.AddDays(7)).Select(x => x).ToList();

    var tableElement = new string[7];
    for (int i = 0; i < 7; i++)
    {
        tableElement[i] = "<td> </td>";
    }
    
    
    for (int d = 0; d < 7; )
    {
        // foreach (DateTime date in dateList)
        //{
            if (dateList.Count == 0)
            {
                <td></td>
                d++;
            }

            else if (dateList.Where(date => date.ToString("dd.MM.rrrr") == dateAcctual.AddDays(d).ToString("dd.MM.rrrr")) != null && d < 7)
            {
                switch (@eventDate.Where(y => y.Value.Contains(dateAcctual)).Select(x => x.Key.RoomState).First())
                {
                    case RoomStates.Zajęty:
                        <td style="background: red"></td>
                        break;

                    case RoomStates.Zarezerowany:
                        <td style="background: orange">></td>
                        break;

                    case RoomStates.Awaria:
                        <td style="background: black">></td>
                        break;

                    case RoomStates.Remont:
                        <td style="background: silver">></td>
                        break;

                    case RoomStates.Wolny:
                        <td></td>
                        break;
                }
                d++;
            }
            else if (dateList.Where(date => date.ToString("dd.MM.rrrr") == dateAcctual.AddDays(d).ToString("dd.MM.rrrr")) == null && d < 7)
            {
                <td></td>
                d++;
            }
            
            
        //}
    }
}
@foreach (RoomEventsViewModel room in Model)
{
    <tr calss="removeBody">
        <td>Pokój @room.Room.RoomName</td>
        @{
            @ShowRoomState(room.EventStayTerm, ViewBag.AcctualDate)
        }

    </tr>
}